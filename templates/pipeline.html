<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Icon Pipeline</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/pipeline.css') }}">
</head>
<body>
<div class="container">

  <div class="top-bar">
    <h1><span>&#9670;</span> Icon Pipeline</h1>
    <a href="/">Back to Studio</a>
  </div>

  <!-- ═══ STEP 1: Brief ═══ -->
  <div class="step">
    <div class="step-header">
      <div class="step-num">1</div>
      <h3>Generate Brief</h3>
      <span class="step-badge badge-text">Text</span>
    </div>
    <div class="step-body">
      <div class="controls">
        <select id="briefModel">
          <option value="gemini-3.1-pro-preview">Gemini 3.1 Pro</option>
          <option value="gemini-3-pro-preview">Gemini 3 Pro</option>
          <option value="gemini-3-flash-preview" selected>Gemini 3 Flash</option>
          <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
          <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
          <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
        </select>
        <select id="briefStyle">
          <option value="outline" selected>Outline</option>
          <option value="solid">Solid / Filled</option>
          <option value="filled-outline">Filled + Outline</option>
          <option value="mixed-fill-outline">Mixed (some filled, some outline)</option>
          <option value="linear">Linear</option>
          <option value="duotone">Duotone</option>
          <option value="flat">Flat</option>
          <option value="glyph">Glyph (icon on shape)</option>
          <option value="hand-drawn">Hand-drawn</option>
          <option value="rounded">Rounded / Friendly</option>
          <option value="sharp">Sharp / Angular</option>
          <option value="thin-line">Thin Line</option>
          <option value="bold-line">Bold Line</option>
          <option value="halftone">Halftone / Stipple</option>
        </select>
      </div>
      <div class="input-area">
        <textarea id="briefPrompt" placeholder="Describe what you need icons for..." autofocus></textarea>
        <div class="input-footer">
          <button id="briefSend" onclick="runBrief()">Generate Brief</button>
        </div>
      </div>
      <div id="briefOutput" class="output-card"></div>
      <div class="step-actions">
        <button id="briefForward" class="btn-secondary" style="display:none" onclick="forwardToImageGen()">Use as image input &#8594;</button>
      </div>
      <div id="briefStatus" class="status"></div>
    </div>
  </div>

  <div class="pipe">
    <div class="pipe-line"></div>
    <span class="pipe-label pipe-json">JSON</span>
    <div class="pipe-line"></div>
  </div>

  <!-- ═══ STEP 2: Image Generation ═══ -->
  <div class="step">
    <div class="step-header">
      <div class="step-num">2</div>
      <h3>Generate Icon Grid</h3>
      <span class="step-badge badge-image">Image</span>
    </div>
    <div class="step-body">
      <div class="controls">
        <select id="imageGenModel">
          <option value="gemini-3.1-flash-image-preview" selected>Gemini 3.1 Flash Image</option>
        </select>
      </div>
      <div class="input-area">
        <textarea id="imageGenPrompt" placeholder="Paste brief or describe the 9 icons for the 3x3 grid..."></textarea>
        <div class="input-footer">
          <button id="imageGenSend" onclick="runImageGen()">Generate Image</button>
        </div>
      </div>
      <div id="imageGenImageOutput" class="image-output"></div>
      <div id="imageGenOutput" class="output-card"></div>
      <div class="step-actions">
        <button id="imageGenForward" class="btn-secondary" style="display:none" onclick="runCrop()">Crop Icons &#8594;</button>
      </div>
      <div id="imageGenStatus" class="status"></div>
    </div>
  </div>

  <div class="pipe">
    <div class="pipe-line"></div>
    <span class="pipe-label pipe-png">PNG</span>
    <div class="pipe-line"></div>
  </div>

  <!-- ═══ STEP 3: Crop (deterministic) ═══ -->
  <div class="step">
    <div class="step-header">
      <div class="step-num" style="background:#059669">3</div>
      <h3>Crop Icons</h3>
      <span class="step-badge" style="background:#1e3a2f;color:#34d399">Deterministic</span>
    </div>
    <div class="step-body">
      <div id="cropOutput" class="output-card"></div>
      <div id="cropGrid" class="icon-grid" style="display:none"></div>
      <div class="step-actions">
        <button id="cropForward" class="btn-secondary" style="display:none" onclick="runTrace()">Trace to SVG &#8594;</button>
      </div>
      <div id="cropStatus" class="status"></div>
    </div>
  </div>

  <div class="pipe">
    <div class="pipe-line"></div>
    <span class="pipe-label pipe-png">PNG</span>
    <div class="pipe-line"></div>
  </div>

  <!-- ═══ STEP 4: Trace (deterministic) ═══ -->
  <div class="step">
    <div class="step-header">
      <div class="step-num" style="background:#059669">4</div>
      <h3>Trace Icons</h3>
      <span class="step-badge" style="background:#1e3a2f;color:#34d399">Deterministic</span>
    </div>
    <div class="step-body">
      <div id="traceOutput" class="output-card"></div>
      <div id="traceGrid" class="trace-list" style="display:none"></div>
      <div id="traceActions" class="step-actions" style="display:none">
        <button id="traceShowAll" class="btn-secondary" onclick="toggleAllCode()">Show All Code</button>
        <button id="traceCopyAll" class="btn-secondary" onclick="copyAllSvgs()">Copy All SVGs</button>
      </div>
      <pre id="traceAllCode" class="svg-code hidden"></pre>
      <div id="traceStatus" class="status"></div>
    </div>
  </div>

</div>

<div id="toolbox" class="toolbox">
  <div class="toolbox-group">
    <label>Mode</label>
    <button id="modeBtn" class="toolbox-btn" onclick="toggleMode()">&#9788; Light</button>
  </div>
  <div class="toolbox-divider"></div>
  <div class="toolbox-group">
    <label>Size</label>
    <input id="sizeSlider" type="range" class="size-slider" min="0" max="100" value="100">
    <span id="sizeValue" class="size-value">100%</span>
  </div>
  <div class="toolbox-divider"></div>
  <button id="mockupBtn" class="toolbox-btn mockup-btn" onclick="openMockup()" title="Preview in mockup">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8"/><path d="M12 17v4"/></svg>
  </button>
</div>

<!-- ═══ Mockup Modal ═══ -->
<div id="mockupOverlay" class="mockup-overlay" onclick="if(event.target===this)closeMockup()">
  <div class="mockup-modal">
    <div class="mockup-chrome">
      <div class="mockup-dots"><span></span><span></span><span></span></div>
      <div class="mockup-address">iconSetGenerator.com</div>
      <button id="mockupDarkBtn" class="mockup-dark-toggle" onclick="toggleMockupDark()">&#9790;</button>
      <button class="mockup-close" onclick="closeMockup()">&#10005;</button>
    </div>
    <div class="mockup-page">
      <nav class="mockup-nav">
        <div class="mockup-logo"><span id="mockupNavIcon0" class="mockup-nav-icon"></span> AppName</div>
        <div class="mockup-nav-links">
          <span class="mockup-nav-link"><span id="mockupNavIcon1" class="mockup-nav-icon"></span> Features</span>
          <span class="mockup-nav-link"><span id="mockupNavIcon2" class="mockup-nav-icon"></span> Pricing</span>
        </div>
      </nav>
      <div class="mockup-hero">
        <div class="mockup-hero-text">
          <div class="mockup-h1"></div>
          <div class="mockup-p"></div>
          <div class="mockup-p short"></div>
        </div>
      </div>
      <div class="mockup-features">
        <div class="mockup-feature" id="mockupFeature0"></div>
        <div class="mockup-feature" id="mockupFeature1"></div>
        <div class="mockup-feature" id="mockupFeature2"></div>
        <div class="mockup-feature" id="mockupFeature3"></div>
        <div class="mockup-feature" id="mockupFeature4"></div>
        <div class="mockup-feature" id="mockupFeature5"></div>
        <div class="mockup-feature" id="mockupFeature6"></div>
        <div class="mockup-feature" id="mockupFeature7"></div>
        <div class="mockup-feature" id="mockupFeature8"></div>
      </div>
    </div>
  </div>
</div>

<script>
  const IMAGE_GEN_PROMPT = {{ image_gen_prompt | tojson }};
  const IMAGE_GEN_SUFFIX = {{ image_gen_suffix | tojson }};
</script>
<script src="{{ url_for('static', filename='js/pipeline.js') }}"></script>
</body>
</html>
